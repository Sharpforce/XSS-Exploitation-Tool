<?php
    require('./vendor/autoload.php');
    include('inc/browserGeo.inc.php');
    $countFromCountries = getCountFromCountries();
?>

<html>
    <head lang="en">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>XSS Exploitation Tool</title>
        <link rel="stylesheet" href="./styles/bootstrap.css"/>
        <link rel="stylesheet" href="./styles/bootstrap-icons.css">
        <link rel="stylesheet" href="./styles/flag-icons.css"/>
        <link rel="stylesheet" href="./styles/svgMap/svgMap.min.css">
        <link rel="stylesheet" href="./styles/style.css"/>
        <link rel="icon" type="image/png" sizes="32x32" href="./images/favicon.ico">
    </head>

    <body id="body">
        <?php        
            include_once('./inc/header.inc.php');
        ?>
        <div class="container-fluid" style="background-color: rgba(0, 0, 0, .5);">
            <div class="row"> 
                <div class="d-flex justify-content-center flex-nowrap">
                    <div class="col">
                    </div>
                    <div class="col">
                        <div class="map p-0" id="svgMap">  
                        </div>
                    </div>
                    <div class="col mx-0">
                    </div>
                </div>
            </div>
        </div> 
        <?php        
            include_once('./inc/footer.inc.php');
        ?>

        <script src="../scripts/svgMap/svg-pan-zoom.js"></script>
        <script src="../scripts/svgMap/svgMap.js"></script>

        <script>
            var headerHeight = document.getElementById("header").clientHeight;
            var subHeaderHeight = document.getElementById("subHeader").clientHeight;
            var footerHeight = document.getElementById("footer").clientHeight;
            var wrapperHeight = window.innerHeight - headerHeight - subHeaderHeight - footerHeight;

            var ratio = window.innerWidth / window.innerHeight;
            var mapWidth = wrapperHeight * ratio;
            document.getElementById("svgMap").setAttribute("style","width:" + mapWidth);
            
            new svgMap({
                targetElementID: 'svgMap',
                mouseWheelZoomEnabled: false,
                colorMax: 'FFFFFF',
                colorMin: 'FFFFFF',
                colorNoData: '#328771',
                noDataText: '',
                data: {
                    data: {
                        hooked: {
                            name: 'Hooked',
                            format: '{0}'
                        }
                    },
                    applyData: 'hooked',
                    values: {
                        <?php
                            if(count($countFromCountries) >= 1) {
                                if(count($countFromCountries) > 1) {
                                    for($i = 0 ; $i < count($countFromCountries) -1 ; $i++) {
                                        echo '"' . $countFromCountries[$i]["countryCode"] . '": { hooked: ' . $countFromCountries[$i]["count"] . '},';
                                    }
                                }
                                echo '"' . end($countFromCountries)['countryCode'] . '": { hooked: ' . end($countFromCountries)['count'] . '},';
                            }
                        ?> 
                    }
                }
            });
            document.getElementsByClassName('svgMap-tooltip')[0].setAttribute("style","opacity: 1.0;");
        </script>

        <script src="scripts/jquery-3.6.1.min.js"></script>
        <script type="text/javascript">
            setInterval("my_function();",3000); 
            function my_function(){
                $('#subHeader').load('./inc/subheader.inc.php');
            }
        </script>
    </body>
</html>