<?php
    require __DIR__ . '/vendor/autoload.php';
    include_once __DIR__ . '/inc/browsers.inc.php';
    include_once __DIR__ . '/inc/browserGeo.inc.php';
?>

<?php
    $hookedBrowsersList = getHookedBrowsers();
    
    if(isset($hookedBrowsersList)) {
        foreach ($hookedBrowsersList as $row) {
            $ua_info = parse_user_agent($row['userAgent']);
            $geoloc = getGeoloc($row['browserId'], $row['publicIP']);
?>
    <tr>
        <td class="bg-transparent text-light text-center"><a href="browserDetails.php?browserId=<?php echo htmlspecialchars($row['browserId']) ?>&page=overview" class="clientID"><?php echo htmlspecialchars($row['browserId']) ?></a></td>
        <td class="bg-transparent align-middle"><img src="./images/<?php echo (isAlive($row['lastHeatbeat']) ? 'online' : 'offline') ?>_button.png" height="20" width="20"/></td>
        <td class="bg-transparent text-light text-center"><?php echo htmlspecialchars(date("d/m/Y H:i:s", strtotime($row['lastHeatbeat']))) ?> (UTC)</td>
        <td class="bg-transparent text-light text-center"><?php echo htmlspecialchars(date("d/m/Y H:i:s", strtotime($row['hookedDate']))) ?> (UTC)</td>
        <td class="bg-transparent align-middle"><img src="./images/user_agent/platform/<?php echo htmlspecialchars(getPlatformIcon($ua_info['platform'])) ?>.png" height="20" width="20" title="<?php echo htmlspecialchars($ua_info['platform']) ?>"/></td>
        <td class="bg-transparent align-middle"><img src="./images/user_agent/browser/<?php echo htmlspecialchars(getBrowserIcon($ua_info['browser'])) ?>.png" height="20" width="20" title="<?php echo htmlspecialchars($ua_info['browser']) ?>"/></td>
        <td class="bg-transparent text-light text-center"><?php echo htmlspecialchars($ua_info['version']) ?></td>
        <td class="bg-transparent align-middle"><span class="fi fi-<?php echo htmlspecialchars($geoloc['countryCode']) ?> fis" title="<?php echo htmlspecialchars($geoloc['country']) ?>"></span></td>
        <td class="bg-transparent text-light text-center"><?php echo htmlspecialchars($row['publicIP']) ?></td>
        <td class="bg-transparent text-light text-center"><?php echo htmlspecialchars($row['hostname']) ?></td>
        <td class="bg-transparent text-light text-center">
            <a class="btn btn-light shadow-none ui-action-icons-details p-1" href="browserDetails.php?browserId=<?php echo htmlspecialchars($row['browserId']) ?>&page=overview" role="button"><i class="bi bi-search"></i></a>
            <form action="index.php" method="POST" style="display:inline;" onsubmit="return confirmDelete();">
                <input type="hidden" name="delete" value="<?php echo htmlspecialchars($row['browserId']); ?>">
                <button type="submit" class="btn btn-danger shadow-none ui-action-icons-delete p-1">
                    <i class="bi bi-trash"></i>
                </button>
            </form>
        </td>
    </tr>
<?php
        }
    }
?>

<script>
    function confirmDelete() {
        return confirm("Are you sure you want to delete this browser?");
    }
</script>