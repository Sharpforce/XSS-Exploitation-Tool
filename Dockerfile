FROM debian:12

ENV DEBIAN_FRONTEND=noninteractive
ENV COMPOSER_ALLOW_SUPERUSER=1

RUN apt-get update && \
    apt-get install -y \
    apache2 \
    php \
    php-mysql \
    php-curl \
    php-dom \
    git \
    composer && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /var/www/html

COPY composer.json composer.lock ./

RUN rm -f index.html && \
    chown -R www-data:www-data /var/www/html && \
    composer install

EXPOSE 80

CMD ["apachectl", "-D", "FOREGROUND"]
