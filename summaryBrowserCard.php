<?php
    require __DIR__ . '/vendor/autoload.php';
    include_once __DIR__  . '/inc/browsers.inc.php';
    include_once __DIR__  . '/inc/browserSummary.inc.php';
    include_once __DIR__ . '/inc/browserGeo.inc.php';
?>

<?php      
    $hookedBrowserDetails = getHookedBrowserDetails($_GET['browserId']);
    
    if(isset($hookedBrowserDetails)) {
        $ua_info = parse_user_agent($hookedBrowserDetails['userAgent']);
        $geoloc = getGeoloc($_GET['browserId'], $hookedBrowserDetails['publicIP']);                
?>
    <tr>
        <td class="bg-transparent text-light text-center align-middle"><span id="browserId"><?php echo htmlspecialchars($hookedBrowserDetails['browserId']) ?></span></td>
        <td class="bg-transparent align-middle"><img src="images/<?php echo (isAlive($hookedBrowserDetails['lastHeatbeat']) ? 'online' : 'offline') ?>_button.png" height="20" width="20"/></td>
        <td class="bg-transparent text-light text-center align-middle"><?php echo htmlspecialchars(date("d/m/Y H:i:s", strtotime($hookedBrowserDetails['lastHeatbeat']))) . ' (UTC)' ?> </td>
        <td class="bg-transparent text-light text-center align-middle"><?php echo htmlspecialchars(date("d/m/Y H:i:s", strtotime($hookedBrowserDetails['hookedDate']))) . ' (UTC)' ?></td>
        <td class="bg-transparent align-middle"><img src="./images/user_agent/platform/<?php echo htmlspecialchars(getPlatformIcon($ua_info['platform'])) . '.png' ?>" height="20" width="20" title="<?php echo htmlspecialchars($ua_info['platform']) ?>"/></td>
        <td class="bg-transparent align-middle"><img src="./images/user_agent/browser/<?php echo htmlspecialchars(getBrowserIcon($ua_info['browser'])) . '.png' ?>" height="20" width="20" title="<?php echo htmlspecialchars($ua_info['browser']) ?>"/></td>
        <td class="bg-transparent text-light text-center align-middle"><?php echo htmlspecialchars($ua_info['version']) ?></td>
        <td class="bg-transparent align-middle"><span class="fi fi-<?php echo htmlspecialchars(strtolower($geoloc['countryCode'])) ?> fis" title="<?php echo htmlspecialchars($geoloc['country']) ?>"></span></td>
        <td class="bg-transparent text-light text-center align-middle"><?php echo htmlspecialchars($hookedBrowserDetails['publicIP']) ?></td>
        <td class="bg-transparent text-light text-center align-middle"><?php echo htmlspecialchars($hookedBrowserDetails['hostname']) ?></td>
        <td class="bg-transparent text-light text-center align-middle">
            <form action="index.php" method="POST" style="display:inline;" onsubmit="return confirmDelete();">
                <input type="hidden" name="delete" value="<?php echo htmlspecialchars($hookedBrowserDetails['browserId']) ?>">
                <button type="submit" class="btn btn-danger shadow-none ui-action-icons-delete p-1">
                    <i class="bi bi-trash"></i>
                </button>
            </form>
        </td>
    </tr>
<?php
    }
?>

<script>
    function confirmDelete() {
        return confirm("Are you sure you want to delete this browser?");
    }
</script>